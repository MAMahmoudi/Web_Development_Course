<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="SRC/CSS/Nav_Bar.css">
    <link rel="stylesheet" href="SRC/CSS/Styles.css">
    <link rel="stylesheet" href="SRC/CSS/Lab_2.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>AJAX</title>
</head>

<body>
    <main>
        <h1 class="Title">Introduction to AJAX</h1>
        <section id="XMLHttpRequest">
            <h3 class="Sub_Section_Title">I. XMLHttpRequest</h3>
            <div class="Definitions">
                <p>
                    AJAX stands for Asynchronous JavaScript and XML. AJAX is a new technique for creating better,
                    faster, and more interactive web applications with the help of XML, HTML, CSS, and JavaScript.
                    AJAX uses XHTML for content, CSS for presentation, along with Document Object Model and JavaScript
                    for dynamic content display. <br>
                    AJAX allows web pages to be updated asynchronously by exchanging small amounts of data with the
                    server behind the scenes. This means that it is possible to update parts of a web page, without
                    reloading the whole page. <br>
                    AJAX is not a programming language. AJAX is a technique for accessing web servers from a web page.
                    <br>
                </p>
            </div>
            <img src="SRC/IMAGES/AJAX/pic_ajax.gif" alt="pic_ajax" class="Smaller_Image">
            <div class="Definitions">
                <p>
                <ol>
                    <li>An event occurs in a web page (the page is loaded, a button is clicked)</li>
                    <li>An XMLHttpRequest object is created by JavaScript</li>
                    <li>The XMLHttpRequest object sends a request to a web server</li>
                    <li>The server processes the request</li>
                    <li>The server sends a response back to the web page</li>
                    <li>The response is read by JavaScript</li>
                    <li>Proper action (like page update) is performed by JavaScript</li>
                </ol>
                </p>
            </div>
            <div class="Definitions">
                <p>
                    In the example below, when a user clicks on the button, the content of the file "My_File.txt" will
                    be loaded into the div element with the id "demo":
                </p>
            </div>
            <div class="card">
                <h2 class="Code_Tag">JavaScript</h2>
                <div class="HTML_Code">
                    <pre class="prettyprint lang-js">
                        <code>
&lt;script&gt;                            
function loadDoc() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        document.getElementById("demo").innerHTML = this.responseText;
        }
        };
        xhttp.open("GET", "My_File.txt", true);
        xhttp.send();
        }
&lt;/script&gt;
&lt;button type="button" onclick="loadDoc()"&gt;Change Content&lt;/button&gt;
&lt;div id="demo"&gt;&lt;/div&gt;
        
                        </code>
                </pre>
                </div>
                <h2 class="Code_Tag">Result</h2>
                <div class="Result_Demo" id="Properties_Result">
                    <button type="button" onclick="loadDoc()">Change Content</button>
                    <p id="demo"></p>
                </div>
            </div>
            <div class="Definitions">
                <p>
                    In the example above, the JavaScript function loadDoc() is triggered by the button click. <br>
                    The function will first create an XMLHttpRequest object <strong>(var xhttp = new
                        XMLHttpRequest();)</strong> <br>
                    The xhttp.onreadystatechange property specifies a function to be executed every time the
                    readyState
                    property changes. <br>
                    The function checks if the readyState property is 4 and the status property is 200. If true, it
                    will
                    write the content of the file "My_File.txt" into the div element with the id "demo". <br>
                    The readyState property holds the status of the XMLHttpRequest. It is an integer from 0 to 4 and
                    it
                    is updated by the XMLHttpRequest object when the request is in progress:<br>
                <ul>
                    <li>0: request not initialized</li>
                    <li>1: server connection established</li>
                    <li>2: request received</li>
                    <li>3: processing request</li>
                    <li>4: request finished and response is ready</li>
                </ul>
                The status property holds the status of the XMLHttpRequest. <br>
                An HTTP status code is returned by the server in response to the request made by the XMLHttpRequest
                object. <br>
                The status property is an integer from 200 to 599:
                <ul>
                    <li>200: "OK"</li>
                    <li>403: "Forbidden"</li>
                    <li>404: "Page not found"</li>
                </ul>
                The open() method specifies the type of request, the URL, and if the request should be handled
                asynchronously or not. <br>
                <ul>
                    <li>The type of request: GET or POST</li>
                    <li>The URL of the server the request is sent to</li>
                    <li>Optional: true (asynchronous) or false (synchronous)</li>
                </ul>
                The send() method sends the request to the server (used for GET requests). <br>
                The responseText property returns the response data as a string. <br>
                The responseXML property returns the response data as XML data. <br>
                The response property returns the response data. <br>
                </p>
            </div>
            <h3 class="Sub_Section_Title">XMLHttpRequest Object Properties</h3>
            <div class="Definitions">
                <p>
                    The following table lists the most important properties of the XMLHttpRequest object:
                </p>
            </div>
            <table class="Table">
                <tr>
                    <th>Property</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>onload</td>
                    <td>Defines a function to be called when the request is received (loaded)</td>
                </tr>
                <tr>
                    <td>onreadystatechange</td>
                    <td>Stores a function (or the name of a function) to be called automatically each time the
                        readyState property changes</td>
                </tr>
                <tr>
                    <td>readyState</td>
                    <td>Holds the status of the XMLHttpRequest. Changes from 0 to 4: <br>
                        0: request not initialized <br>
                        1: server connection established <br>
                        2: request received <br>
                        3: processing request <br>
                        4: request finished and response is ready</td>
                </tr>
                <tr>
                    <td>responseText</td>
                    <td>Returns the response data as a string</td>
                </tr>
                <tr>
                    <td>responseXML</td>
                    <td>Returns the response data as XML data</td>
                </tr>
                <tr>
                    <td>status</td>
                    <td>Returns the status-number of a request</td>
                </tr>
                <tr>
                    <td>statusText</td>
                    <td>Returns the status-text (e.g. "OK" or "Not Found")</td>
                </tr>
            </table>
            <div class="Definitions">
                <p>
                    Bellow is an example of how to use the onload property of the XMLHttpRequest object:
                </p>
            </div>
            <div class="card">
                <h2 class="Code_Tag">JavaScript</h2>
                <div class="HTML_Code">
                    <pre class="prettyprint lang-js lang-html">
                        <code>
&lt;script&gt;
var xhttp = new XMLHttpRequest();
xhttp.onload = function() {
    if (this.status == 200) {
        document.getElementById("demo").innerHTML = this.responseText;
    }
};
xhttp.open("GET", "My_File2.txt", true);
xhttp.send();
&lt;/script&gt;
&lt;div id="demo"&gt;&lt;/div&gt;
                        </code>
                </pre>
                </div>
                <h2 class="Code_Tag">Result</h2>
                <div class="Result_Demo" id="Properties_Result">
                    <p id="demo2"></p>
                </div>
            </div>
            <div class="Definitions">
                <p>
                    In the example above, the onload property is used to define a function to be called when the request
                    is received. <br>
                    The function checks if the status property is 200 (OK). If true, it writes the content of the file
                    "My_File2.txt" into the div element with the id "demo". <br>
                </p>
            </div>
            <h3 class="Sub_Section_Title">XMLHttpRequest Object Methods</h3>
            <div class="Definitions">
                <p>
                    The following table lists the most important methods of the XMLHttpRequest object:
                </p>
            </div>
            <table class="Table">
                <tr>
                    <th>Method</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>abort()</td>
                    <td>Cancels the current request</td>
                </tr>
                <tr>
                    <td>getAllResponseHeaders()</td>
                    <td>Returns header information</td>
                </tr>
                <tr>
                    <td>getResponseHeader()</td>
                    <td>Returns specific header information</td>
                </tr>
                <tr>
                    <td>open(method, url, async, user, psw)</td>
                    <td>Specifies the type of request: method: GET or POST, url: the server (file) location, async:
                        true (asynchronous) or false (synchronous), user: optional user name, psw: optional password
                    </td>
                </tr>
                <tr>
                    <td>send()</td>
                    <td>Sends the request to the server (used for GET)</td>
                </tr>
                <tr>
                    <td>setRequestHeader()</td>
                    <td>Adds a label/value pair to the header to be sent</td>
                </tr>
            </table>
            <h3 class="Sub_Section_Title">Example</h3>
            <div class="Definitions">
                <p>
                    To illustrate the use of AJAX, we will create a simple example that will fetch data from a MySQL
                    database using PHP. You can find the complete code <a
                        href="https://github.com/MAMahmoudi/AJAX_PHP_EXAMPLE">here.</a> <br>
                    In the example bellow, we will create a database "ajax_php_example" with a table "product" with the
                    following structure:
                </p>
            </div>
            <img src="SRC/IMAGES/AJAX/Product.png" alt="Product.png" class="Smaller_Image">
            <div class="Definitions">
                <p>
                    In the index.php file, we put a table that will display the data from the "product" table and a
                    button to add new products. <br>
                    We have only declared a table without defining its structure. We will the Read.php file to do that.
                </p>
            </div>

            <pre class="prettyprint lang-php">
                        <code>
&lt;h1>Product List&lt;/h1>
&lt;button type="button" class="btn btn-primary" id="Add_Btn">Add &lt;/button>
&lt;table class="table table-striped" id="Product_Table">
&lt;?php require_once 'Read.php'; ?>
&lt;/table>
        </code>
        </pre>

            <div class="Definitions">
                <p>
                    In the Read.php file, we will write the PHP code that will fetch the data from the "product" table
                    and display it in the table. <br>
                    This code create a table with the headers for the columns and then selects all the data from the
                    Product table. <br>
                    An additional column is added to the table for the actions (Edit and Delete). <br>
                    The Delete button will call the Delete() function with the Product_ID as a parameter. <br>
                    The Edit button will call the Edit() function with the Product_ID as a parameter. <br>
                    This is is the easiest way to keep track of the product that we want to edit or delete. <br>
                </p>
            </div>

            <pre class="prettyprint lang-php">
                    <code>
&lt;?php
/*
    * This file is used to read data from the database and display it in the table.
    * It is included in index.php.
    */
// It start by requiring the Connect.php file to establish a connection to the database.    
require_once "Connect.php";
// It then creates a table with the headers for the columns.
echo " &lt;tr>
&lt;th>Product code&lt;/th>
&lt;th>Product name&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Price&lt;/th>
&lt;th>Actions&lt;/th>
&lt;/tr>";
// It then selects all the data from the Product table.
$sql = "SELECT * FROM Product";
$result = mysqli_query($My_Connection, $sql);

if (mysqli_num_rows($result) > 0) {
    while ($row = mysqli_fetch_assoc($result)) {
        // It then creates a row for each product in the table.
        echo "&lt;tr>";
        echo "&lt;td>" . $row["Product_ID"] . "&lt;/td>";
        echo "&lt;td>" . $row["Product_Name"] . "&lt;/td>";
        echo "&lt;td>" . $row["Product_Description"] . "&lt;/td>";
        echo "&lt;td>" . $row["Price"] . "&lt;/td>";
        echo "&lt;td>&lt;button type='button' class='btn btn-danger' onclick='Delete(" . $row["Product_ID"] . ")'>Delete&lt;/button>";
        echo "&lt;button type='button' class='btn btn-success' onclick='Edit(" . $row["Product_ID"] . ")'>Edit&lt;/button>&lt;/td>";
        echo "&lt;/tr>";
    }
} else {
    echo "0 results";
}

                        </code>
                        </pre>
            <div class="Definitions">
                <p>
                    When the user clicks on the Add button, a modal will pop up with a form to add a new product.
                    <br>
                    The form will have fields for the Product Name, Description, and Price. <br>
                    When the user submits the form, the data will be sent to the server using AJAX. <br>
                    The data will be sent to the add.php file, which will insert the data into the Product table. <br>
                    The add.php file will then call the Read.php file to display the updated table. <br>
                </p>
            </div>
            <pre class="prettyprint lang-js">
                                <code>
// We add an event listener to the Add_Form
Add_Form.addEventListener("submit", function (event) {
  // We prevent the default behavior of the form
  event.preventDefault();
  // We create a new XMLHttpRequest object
  const xhr = new XMLHttpRequest();
  // We open a new POST request to the add.php file
  xhr.open("POST", "add.php");
  // We set the Content-Type header to "application/x-www-form-urlencoded"
  // This header is used to specify the type of data that is being sent to the server
  // In this case, we are sending form data to the server in the format of key-value pairs
  xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
  // We add an event listener to the xhr object
  // This event listener is called every time the readyState property of the xhr object changes
  // The readyState property of the xhr object represents the state of the request
  // The onreadystatechange event is triggered when the readyState property changes
  xhr.onreadystatechange = function () {
    // We check if the readyState property is equal to XMLHttpRequest.DONE
    // This means that the request has been completed
    // We also check if the status property is equal to 200
    // This means that the request was successful
    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
      // If the request was successful,
      // we set the innerHTML of the Table element to the responseText of the xhr object
      // The xhr.responseText property contains the result of Read.php file since it is called
      // at the end of add.php
      Table.innerHTML = xhr.responseText;
    }
  };
  // We get the values of the input fields in the Add_Form
  // We use the encodeURIComponent function to encode the values
  // so that they can be sent as part of the URL
  const Product_ID = encodeURIComponent(
    document.getElementById("Product_ID").value
  );
  const Product_Name = encodeURIComponent(
    document.getElementById("Product_Name").value
  );
  const Product_Description = encodeURIComponent(
    document.getElementById("Product_Description").value
  );
  const Price = encodeURIComponent(document.getElementById("Price").value);
  // The following are the parameters that will be sent to the server
  // They are in the format of key-value pairs
  const snd = `Product_ID=${Product_ID}&Product_Name=${Product_Name}&Product_Description=${Product_Description}&Price=${Price}`;
  // We send the parameters to the server
  xhr.send(snd);
  // We hide the Dark_Background and Add_Form
  Dark_Background.classList = "Hidden";
  Add_Form.classList = "Hidden";
});
</code>
</pre>
            <div class="Definitions">
                <p>
                    In other words, the "Table.innerHTML = xhr.responseText;" will wait untill the file that we called
                    earlier with the "xhr.open("POST", "add.php");" is done and then take its response (which is
                    "xhr.responseText") and put it in the
                    innerHTML of the Table element. <br>
                    That is why we called Read.php at the end of the add.php file. <br>
                </p>
            </div>
            <pre class="prettyprint lang-php">
    <code>
        &lt;?php
// This file is used to add data to the database.
// It starts by requiring the Connect.php file to establish a connection to the database.
require_once "Connect.php";
// It then checks if the request method is POST.
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // It then gets the data from the form and assigns it to variables.
    $Product_ID = $_POST["Product_ID"];
    $Product_Name = $_POST["Product_Name"];
    $Description = $_POST["Product_Description"];
    $Price = $_POST["Price"];
    // It then inserts the data into the Product table.
    $sql = "INSERT INTO Product (Product_ID, Product_Name, Product_Description, Price) VALUES (?, ?, ?, ?)";
    $stmt = mysqli_stmt_init($My_Connection);
    if (!mysqli_stmt_prepare($stmt, $sql)) {
        echo "SQL statement failed";
    } else {
        mysqli_stmt_bind_param($stmt, "isss", $Product_ID, $Product_Name, $Description, $Price);
        mysqli_stmt_execute($stmt);
    }
}
// It then calls the Read.php file to display the updated table.
require_once "Read.php";
</code>
</pre>
            <div class="Definitions">
                <p>
                    For the Edit and Delete functionalities, we will use the same approach. <br>
                    The only thing that changes in the Edit.php and Delete.php files is the SQL query. <br>
                </p>
            </div>
        </section>

    </main>
    <footer class="Inter_Pages">
        <a href="DOM.html" class="Arrow">
            <i class="fa-solid fa-angles-left fa-beat fa-2xl"></i>
            <h1>DOM</h1>
        </a>
        <a href="JS_Form_Validation.html" class="Arrow">
            <h1>JS Form Validation</h1><i class="fa-solid fa-angles-right fa-beat fa-2xl"></i>
        </a>
    </footer>
    <script src="SRC/JS/Script.js" type="module"></script>
    <script src="SRC/JS/AJAX.js"></script>
    <script
        src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=c&amp;skin=sunburst">
        </script>
</body>

</html>